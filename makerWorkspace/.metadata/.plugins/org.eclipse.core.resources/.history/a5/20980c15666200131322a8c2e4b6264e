package com.TweetyPi.PyTwitter.TwitterHandler;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.net.URL;
import java.net.URLConnection;

import twitter4j.internal.org.json.JSONException;
import twitter4j.internal.org.json.JSONObject;


public class NewsHandler {

	public String getHeadline(String search) throws IOException {
		String headline = "No headline found";
		String searchTerm = search.replaceAll("\\s","%20");
		URL url = new URL(
				"https://ajax.googleapis.com/ajax/services/search/news?"
						+ "v=1.0&q=" + searchTerm + "&userip=INSERT-USER-IP");
		URLConnection connection = url.openConnection();
		// connection.addRequestProperty("Referer", /* Enter the URL of your
		// site here */);

		String line;
		StringBuilder builder = new StringBuilder();
		BufferedReader reader = new BufferedReader(new InputStreamReader(
				connection.getInputStream()));
		while ((line = reader.readLine()) != null) {
			if (line.contains("titleNoFormatting")) {
				builder.append(line);
			}
		}
		try {
			JSONObject json = new JSONObject(builder.toString());
			//System.out.println(json.toString());
			// System.out.println(json.get("responseData"));
			String result = json.toString();
			result.toLowerCase();
			if(result.contains("titleNoFormatting")){
				int position = result.indexOf("titleNoFormatting");
				//System.out.println(position);
				int finals = position + 200;
				String end = result.substring(position, finals);
				//System.out.println(end);
				int endPos = end.indexOf(",");
				int start =  20;
				if(end.charAt(endPos +1) == '"'){
					headline = end.substring(start, endPos-1);
					headline = headline.replaceAll("&#39;"," ");
					
				}else{
					String second = end.substring(endPos);
					int nextComma = second.indexOf(",");
					headline = end.substring(start, nextComma-1);
					headline = headline.replaceAll("&#39;"," ");
					
				}
			}

		} catch (JSONException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		return headline;
	}
	
	public static void main(String[] args){
		NewsHandler nh = new NewsHandler();
		try {
			System.out.println(nh.getHeadline("Arsenal"));
		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	}

}
